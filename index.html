<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hortlaklı Köy</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">
    <div id="nickname-screen">
      <h2>Nick Seç</h2>
      <input type="text" id="nickname" placeholder="Takma adını yaz" />
      <button id="continueBtn">Devam</button>
    </div>

    <div id="lobby-options" style="display:none;">
      <h2>Lobi Seçenekleri</h2>
      <button id="createLobbyBtn">Lobi Oluştur</button>
      <button id="listLobbiesBtn">Lobiler</button>
    </div>

    <div id="create-lobby-screen" style="display:none;">
      <h2>Lobi Oluştur</h2>
      <input type="text" id="lobbyName" placeholder="Lobi adı" />
      <button id="confirmCreateLobbyBtn">Oluştur</button>
    </div>

    <div id="lobby-list-screen" style="display:none;">
      <h2>Mevcut Lobiler</h2>
      <ul id="lobby-list"></ul>
    </div>

    <div id="lobby-room" style="display:none;">
      <h2 id="lobby-title"></h2>
      <div id="players" style="display: flex; flex-wrap: wrap;"></div>
      <button id="startGameBtn" style="display:none;">Oyunu Başlat</button>
    </div>
  </div>

  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
        integrity="sha384-KKHvKjq0MOkB8Myx1pQ2GQyRhzo2ELIuZXPyy0VCOEYO1S5kHb4YXrW29a9zK1NV"
        crossorigin="anonymous"></script>
  <script>
    window.socket = io("https://hortlakli-koy-server.onrender.com");

    document.getElementById("continueBtn").addEventListener("click", () => {
      const nickname = document.getElementById("nickname").value.trim();
      if (!nickname) return alert("Nick giriniz.");
      window.nickname = nickname;
      document.getElementById("nickname-screen").style.display = "none";
      document.getElementById("lobby-options").style.display = "block";
    });

    document.getElementById("createLobbyBtn").addEventListener("click", () => {
      document.getElementById("lobby-options").style.display = "none";
      document.getElementById("create-lobby-screen").style.display = "block";
    });

    document.getElementById("listLobbiesBtn").addEventListener("click", () => {
      document.getElementById("lobby-options").style.display = "none";
      document.getElementById("lobby-list-screen").style.display = "block";
      if (window.socket) {
        window.socket.emit("getLobbies");
      }
    });

    document.getElementById("confirmCreateLobbyBtn").addEventListener("click", () => {
      const lobbyName = document.getElementById("lobbyName").value.trim();
      if (!lobbyName) return alert("Lobi adı giriniz.");
      window.socket.emit("createLobby", { lobbyName, nickname: window.nickname });
    });

    window.socket.on("lobbyList", (lobbies) => {
      const list = document.getElementById("lobby-list");
      list.innerHTML = "";
      lobbies.forEach((lobby) => {
        const li = document.createElement("li");
        li.textContent = `${lobby.name} (${lobby.players.length}/20)`;
        li.style.cursor = "pointer";
        li.onclick = () => {
          window.socket.emit("joinLobby", { lobbyId: lobby.id, nickname: window.nickname });
        };
        list.appendChild(li);
      });
    });

    window.socket.on("lobbyJoined", ({ lobby, players }) => {
      document.getElementById("create-lobby-screen").style.display = "none";
      document.getElementById("lobby-list-screen").style.display = "none";
      document.getElementById("lobby-room").style.display = "block";
      document.getElementById("lobby-title").textContent = lobby.name;
      window.currentLobbyId = lobby.id;
      const playerContainer = document.getElementById("players");
      playerContainer.innerHTML = "";
      players.forEach((player) => {
        const div = document.createElement("div");
        div.textContent = player.nickname;
        div.classList.add("player-box");
        playerContainer.appendChild(div);
      });
      if (players.length >= 6 && window.nickname === lobby.owner) {
        document.getElementById("startGameBtn").style.display = "block";
      } else {
        document.getElementById("startGameBtn").style.display = "none";
      }
    });

    document.getElementById("startGameBtn").addEventListener("click", () => {
      if (window.currentLobbyId) {
        window.socket.emit("startGame", { lobbyId: window.currentLobbyId });
      }
    });
  </script>
</body>
</html>
